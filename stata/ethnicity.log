--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\rmjlton\GitHub\priority\codelists\ethnicity.log
  log type:  text
 opened on:  18 Feb 2025, 21:48:17

. 
. 
. //= CPRD LOOKUP LOCATION - would be good to get this in a shared location ======
. 
. //*Directory of medical dictionary*
. local browser_dir "C:/Users/rmjlton/OneDrive - University College London/PRIORITY/lookups/`aurum_build'_Lookups_CPRDAurum"

. 
. //*Directory of label lookups*
. local lookup_dir "C:/Users/rmjlton/OneDrive - University College London/PRIORITY/lookups/`aurum_build'_Lookups_CPRDAurum"

. 
. //==============================================================================
. 
. //Import latest medical browser; force medcodeid, SNOMED CT Description ID, and SNOMED CT Concept ID to be string
. //import delimited "`browser_dir'/CPRDAurumMedical.txt", stringcols(1 6 7) favorstrfixed
. import delimited "`browser_dir'/`aurum_build'_EMISMedicalDictionary.txt", stringcols(1 6 7) favorstrfixed
(encoding automatically selected: UTF-8)
(9 vars, 240,999 obs)

. 
. //Drop useless variables
. drop release emiscodecategoryid

. 
. order medcodeid observations originalreadcode cleansedreadcode ///
>         snomedctconceptid snomedctdescriptionid term

. 
. //Save medical code browser to a tempfile
. tempfile medical

. save `medical'
file C:\Users\rmjlton\AppData\Local\Temp\ST_6a40_000001.tmp saved as .dta format

. 
. 
. // STEP 0. COMBINE EXTERNAL CODELIST(S) TO USE AS A GUIDE
. //========================================================
. 
. //Comment this section out if no pre-existing codelists
. 
. //MedCodeID codelists (LSHTM Data Compass)
. 
. //Format pre-existing codelist(s) ready for merging
. preserve

.         import delimited https://datacompass.lshtm.ac.uk/id/eprint/2102/65/ethnicity_aurum_may20.txt, stringcols(1) favorstrfixed clear
(encoding automatically selected: ISO-8859-1)
(4 vars, 263 obs)

.         
.         label define eth5 ///
>                 1 "White" ///
>                 2 "South Asian" ///
>                 3 "Black" ///
>                 4 "Other" ///
>                 5 "Mixed" ///
>                 6 "Not Stated"

.         replace eth5 = "1" if eth5 == "0. White"
(66 real changes made)

.         replace eth5 = "2" if eth5 == "1. South Asian"
(47 real changes made)

.         replace eth5 = "3" if eth5 == "2. Black"
(49 real changes made)

.         replace eth5 = "4" if eth5 == "3. Other"
(47 real changes made)

.         replace eth5 = "5" if eth5 == "4. Mixed"
(33 real changes made)

.         replace eth5 = "6" if eth5 == "5. Not Stated"
(21 real changes made)

.         destring eth5, replace
eth5: all characters numeric; replaced as byte

.         label values eth5 eth5

.         
.         label define eth16 ///
>                 1 "British" ///
>                 2 "Irish" ///
>                 3 "Other White" ///
>                 4 "White and Black Caribbean" ///
>                 5 "White and Black African" ///
>                 6 "White and Asian" ///
>                 7 "Other Mixed" ///
>                 8 "Indian" ///
>                 9 "Pakistani" ///
>                 10 "Bangladeshi" ///
>                 11 "Other Asian" ///
>                 12 "Caribbean" ///
>                 13 "African" ///
>                 14 "Other Black" ///
>                 15 "Chinese" ///
>                 16 "Other ethnic group" ///
>                 17 "Not Stated"

.         replace eth16 = "1" if eth16 == "1. British"
(19 real changes made)

.         replace eth16 = "2" if eth16 == "2. Irish"
(7 real changes made)

.         replace eth16 = "3" if eth16 == "3. Other White"
(40 real changes made)

.         replace eth16 = "4" if eth16 == "4. White and Black Caribbean"
(4 real changes made)

.         replace eth16 = "5" if eth16 == "5. White and Black African"
(5 real changes made)

.         replace eth16 = "6" if eth16 == "6. White and Asian"
(4 real changes made)

.         replace eth16 = "7" if eth16 == "7. Other Mixed"
(20 real changes made)

.         replace eth16 = "8" if eth16 == "8. Indian"
(8 real changes made)

.         replace eth16 = "9" if eth16 == "9. Pakistani"
(7 real changes made)

.         replace eth16 = "10" if eth16 == "10. Bangladeshi"
(7 real changes made)

.         replace eth16 = "11" if eth16 == "11. Other Asian"
(25 real changes made)

.         replace eth16 = "12" if eth16 == "12. Caribbean"
(6 real changes made)

.         replace eth16 = "13" if eth16 == "13. African"
(12 real changes made)

.         replace eth16 = "14" if eth16 == "14. Other Black"
(31 real changes made)

.         replace eth16 = "15" if eth16 == "15. Chinese"
(5 real changes made)

.         replace eth16 = "16" if eth16 == "16. Other ethnic group"
(42 real changes made)

.         replace eth16 = "17" if eth16 == "17. Not Stated"
(21 real changes made)

.     destring eth16, replace
eth16: all characters numeric; replaced as byte

.         label values eth16 eth16

.         
.         //Remove "Not Stated" codes
.         tab eth16 eth5, missing

                      |                               eth5
                eth16 |     White  South Asi      Black      Other      Mixed  Not State |     Total
----------------------+------------------------------------------------------------------+----------
              British |        19          0          0          0          0          0 |        19 
                Irish |         7          0          0          0          0          0 |         7 
          Other White |        40          0          0          0          0          0 |        40 
White and Black Carib |         0          0          0          0          4          0 |         4 
White and Black Afric |         0          0          0          0          5          0 |         5 
      White and Asian |         0          0          0          0          4          0 |         4 
          Other Mixed |         0          0          0          0         20          0 |        20 
               Indian |         0          8          0          0          0          0 |         8 
            Pakistani |         0          7          0          0          0          0 |         7 
          Bangladeshi |         0          7          0          0          0          0 |         7 
          Other Asian |         0         25          0          0          0          0 |        25 
            Caribbean |         0          0          6          0          0          0 |         6 
              African |         0          0         12          0          0          0 |        12 
          Other Black |         0          0         31          0          0          0 |        31 
              Chinese |         0          0          0          5          0          0 |         5 
   Other ethnic group |         0          0          0         42          0          0 |        42 
           Not Stated |         0          0          0          0          0         21 |        21 
----------------------+------------------------------------------------------------------+----------
                Total |        66         47         49         47         33         21 |       263 

.         drop if eth5 == 6
(21 observations deleted)

.         drop if eth16 == 17
(0 observations deleted)

.         
.         local name "lshtm_2102"

.         
.         rename term term_`name'

.         generate byte external_codelist = 1

.         generate byte `name' = 1

.         
.         count
  242

. 
.         tempfile `name'

.         save ``name''
file C:\Users\rmjlton\AppData\Local\Temp\ST_6a40_000003.tmp saved as .dta format

. restore, preserve

.         import delimited https://datacompass.lshtm.ac.uk/id/eprint/2414/1/cr_codelist_ethnicity_aurum.txt, stringcols(1) favorstrfixed clear
(encoding automatically selected: ISO-8859-1)
(2 vars, 263 obs)

.         
.         //NO CATEGORISATION PROVIDED
.         
.         local name "lshtm_2414"

.         
.         rename term term_`name'

.         generate byte external_codelist = 1

.         generate byte `name' = 1

.         
.         count
  263

. 
.         tempfile `name'

.         save ``name''
file C:\Users\rmjlton\AppData\Local\Temp\ST_6a40_000004.tmp saved as .dta format

. restore, preserve

.         import delimited https://datacompass.lshtm.ac.uk/id/eprint/4214/24/covariate_ethniciity_aurum.txt, stringcols(1) favorstrfixed clear
(encoding automatically selected: ISO-8859-1)
(3 vars, 290 obs)

.         
.         label define eth5 ///
>                 1 "White" ///
>                 2 "South Asian" ///
>                 3 "Black" ///
>                 4 "Other" ///
>                 5 "Mixed" ///
>                 6 "Not Stated"

.         replace eth5 = "1" if eth5 == "0. White"
(74 real changes made)

.         replace eth5 = "2" if eth5 == "1. South Asian"
(44 real changes made)

.         replace eth5 = "3" if eth5 == "2. Black"
(49 real changes made)

.         replace eth5 = "4" if eth5 == "3. Other"
(70 real changes made)

.         replace eth5 = "5" if eth5 == "4. Mixed"
(33 real changes made)

.         replace eth5 = "6" if eth5 == "5. Not Stated"
(19 real changes made)

.         destring eth5, replace
eth5: all characters numeric; replaced as byte
(1 missing value generated)

.         label values eth5 eth5

.         
.         //Remove "Not Stated" codes
.         tab eth5, missing

       eth5 |      Freq.     Percent        Cum.
------------+-----------------------------------
      White |         74       25.52       25.52
South Asian |         44       15.17       40.69
      Black |         49       16.90       57.59
      Other |         70       24.14       81.72
      Mixed |         33       11.38       93.10
 Not Stated |         19        6.55       99.66
          . |          1        0.34      100.00
------------+-----------------------------------
      Total |        290      100.00

.         drop if eth5 == 6
(19 observations deleted)

.         
.         local name "lshtm_4214"

.         
.         rename term term_`name'

.         generate byte external_codelist = 1

.         generate byte `name' = 1

.         
.         count
  271

. 
.         tempfile `name'

.         save ``name''
file C:\Users\rmjlton\AppData\Local\Temp\ST_6a40_000005.tmp saved as .dta format

. restore

. 
. //SNOMED CT codelists (HDR UK Phenotype Library and OpenCodelists)
. 
. //Format pre-existing codelist(s) ready for merging
. preserve

.         import delimited https://www.opencodelists.org/codelist/opensafely/ethnicity-snomed-0removed/2e641f61/download.csv, stringcols(1) favorstrfixed clear
(encoding automatically selected: UTF-8)
(4 vars, 599 obs)

.         
.         rename snomedcode snomedctconceptid

.         
.         //OpenSAFELY's 5 category ethnicity is ordered differently
.         /* Their categorisation:
>         1 "White" ///
>         2 "Mixed" ///
>         3 "Asian or Asian British" ///
>         4 "Black or Black British" ///
>         5 "Chinese or Other Ethnic Groups"
>         */
.         rename grouping_6 eth5

.         recode eth5 (2 = 5) (3 = 2) (4 = 3) (5 = 4)
(439 changes made to eth5)

.         label define eth5 ///
>                 1 "White" ///
>                 2 "South Asian" ///
>                 3 "Black" ///
>                 4 "Other" ///
>                 5 "Mixed" ///
>                 6 "Not Stated"

.         label values eth5 eth5

.         
.         rename grouping_16 eth16

.         label define eth16 ///
>                 1 "British" ///
>                 2 "Irish" ///
>                 3 "Other White" ///
>                 4 "White and Black Caribbean" ///
>                 5 "White and Black African" ///
>                 6 "White and Asian" ///
>                 7 "Other Mixed" ///
>                 8 "Indian" ///
>                 9 "Pakistani" ///
>                 10 "Bangladeshi" ///
>                 11 "Other Asian" ///
>                 12 "Caribbean" ///
>                 13 "African" ///
>                 14 "Other Black" ///
>                 15 "Chinese" ///
>                 16 "Other ethnic group" ///
>                 17 "Not Stated"

.         label values eth16 eth16

.         
.         local name "oc_opensafely_ethnicity"

.         
.         rename ethnicity term_`name'

.         rename eth5 eth5_`name'

.         rename eth16 eth16_`name'

.         
.         generate byte external_codelist = 1

.         generate byte `name' = 1

.         
.         count
  599

. 
.         tempfile `name'

.         save ``name''
file C:\Users\rmjlton\AppData\Local\Temp\ST_6a40_000007.tmp saved as .dta format

. restore

. 
. //Merge into medical browser
. use `medical', clear

. count
  240,999

. 
. //Medcode lists
. foreach external_med in lshtm_2102 lshtm_2414 lshtm_4214 {
  2.         
.         merge 1:1 medcodeid using ``external_med'', update replace
  3.         drop if _merge == 2
  4.         
.         display "Conflicts..."
  5.         list medcodeid term eth16 eth5 if _merge == 5
  6.         drop _merge
  7.         
.         display "Differences in term from CPRD dictionary..."
  8.         count if lower(term) != lower(term_`external_med') & term_`external_med' != ""
  9.         list term term_`external_med' ///
>                 if lower(term) != lower(term_`external_med') & term_`external_med' != ""
 10.         drop term_`external_med'
 11. }

    Result                      Number of obs
    -----------------------------------------
    Not matched                       240,759
        from master                   240,758  (_merge==1)
        from using                          1  (_merge==2)

    Matched                               241
        not updated                       241  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------
(1 observation deleted)
Conflicts...
Differences in term from CPRD dictionary...
  61

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50807. |                                                                                                                                      term |
        |                                                                                                                            Afro-Caribbean |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                                                               race: afro-caribbean                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50809. |                                                                                                                                      term |
        |                                                                                                                            Afro-Caucasian |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                                                               race: afro-caucasian                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50821. |                                                                                                                                      term |
        |                                                                                                                            Caucasian race |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                                                                    race: caucasian                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50908. |                                                                                                                                      term |
        |                          White: English or Welsh or Scottish or Northern Irish or British - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       white:eng/welsh/scot/ni/brit - england and wales 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50909. |                                                                                                                                      term |
        |                                                           White: Gypsy or Irish Traveller - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       white: gypsy/irish traveller - eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50910. |                                                                                                                                      term |
        |                                                         White: any other White background - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       white: other white backgrd- eng+wales ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50911. |                                                                                                                                      term |
        |                                   Mixed multiple ethnic groups: White and Black Caribbean - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       mixed: white+black caribbean - eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50912. |                                                                                                                                      term |
        |                                     Mixed multiple ethnic groups: White and Black African - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                         mixed: white+black african - eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50913. |                                                                                                                                      term |
        |                                             Mixed multiple ethnic groups: White and Asian - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                         mixed: white+asian - eng+wales ethnic category 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50915. |                                                                                                                                      term |
        |                                                            Asian or Asian British: Indian - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                        asian/asian brit: indian - eng+wales ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50916. |                                                                                                                                      term |
        |                                                         Asian or Asian British: Pakistani - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       asian/asian british:pakistani- eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50917. |                                                                                                                                      term |
        |                                                       Asian or Asian British: Bangladeshi - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       asian/asian brit: bangladeshi- eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50919. |                                                                                                                                      term |
        |                                                           Asian or Asian British: Chinese - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       asian/asian brit: chinese - eng+wales ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50920. |                                                                                                                                      term |
        |                                        Asian or Asian British: any other Asian background - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       asian/asian brit: other asian- eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50921. |                                                                                                                                      term |
        |                                   Black or African or Caribbean or Black British: African - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       black/african/carib/black brit: african- eng+wales 2011 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50922. |                                                                                                                                      term |
        |                                 Black or African or Caribbean or Black British: Caribbean - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       black/african/caribbn/black brit: caribbean - eng+wales 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50924. |                                                                                                                                      term |
        |                                                                  Other ethnic group: Arab - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                        other ethnic group: arab - eng+wales ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50925. |                                                                                                                                      term |
        |                                                Other ethnic group: any other ethnic group - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                        other ethnic: any other grp - eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50926. |                                                                                                                                      term |
        |                                                                            Irish Traveller - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                          irish traveller - northern ireland ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50927. |                                                                                                                                      term |
        |                                    Mixed multiple ethnic groups: White and Black Caribbean - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       mixed: white and black caribbean - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50928. |                                                                                                                                      term |
        |                                      Mixed multiple ethnic groups: White and Black African - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                         mixed: white and black african - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50929. |                                                                                                                                      term |
        |                                              Mixed multiple ethnic groups: White and Asian - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                            mixed: white and asian - ni ethnic category 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50930. |                                                                                                                                      term |
        |                Mixed multiple ethnic groups: any other Mixed or multiple ethnic background - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                        mixed: other mixed/multiple ethnic backgrd - ni 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50931. |                                                                                                                                      term |
        |                                                             Asian or Asian British: Indian - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                         asian or asian british: indian - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50932. |                                                                                                                                      term |
        |                                                          Asian or Asian British: Pakistani - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                         asian/asian british: pakistani - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50933. |                                                                                                                                      term |
        |                                                        Asian or Asian British: Bangladeshi - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       asian/asian british: bangladeshi - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50934. |                                                                                                                                      term |
        |                                                            Asian or Asian British: Chinese - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                           asian/asian british: chinese - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50935. |                                                                                                                                      term |
        |                                         Asian or Asian British: any other Asian background - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       asian/asian british: other asian - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50936. |                                                                                                                                      term |
        |                                    Black or African or Caribbean or Black British: African - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       black/afri/carib/black brit: african- ni eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50937. |                                                                                                                                      term |
        |                                  Black or African or Caribbean or Black British: Caribbean - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       black/afri/carib/black brit: caribbean- ni eth cat 2011 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50939. |                                                                                                                                      term |
        |                                                                   Other ethnic group: Arab - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                          other ethnic group: arab - ni ethnic category 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50940. |                                                                                                                                      term |
        |                                                 Other ethnic group: any other ethnic group - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       other ethnic group: any other grp- ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50942. |                                                                                                                                      term |
        |                                                                    White: Gypsy or Irish Traveller - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       white: gypsy/irish traveller - scotland ethnic cat 2011 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50943. |                                                                                                                                      term |
        |                                                                White: any other White ethnic group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       white: other white ethnic grp- scotland ethnic cat 2011 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50944. |                                                                                                                                      term |
        |                                Mixed or multiple ethnic groups: any Mixed or multiple ethnic group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       mixed/multiple ethnic grps: any- scot ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50945. |                                                                                                                                      term |
        |       Asian or Asian Scottish or Asian British: Pakistani, Pakistani Scottish or Pakistani British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                          asian: pakistani/pakistani scot/pakistani brit- scot 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50946. |                                                                                                                                      term |
        |                Asian or Asian Scottish or Asian British: Indian, Indian Scottish or Indian British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       asian: indian, indian scot/indian brit- scotland 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50947. |                                                                                                                                      term |
        | Asian or Asian Scottish or Asian British: Bangladeshi, Bangladeshi Scottish or Bangladeshi British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       bangladeshi, bangladeshi scot or bangladeshi brit- scot 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50948. |                                                                                                                                      term |
        |                                                  Asian or Asian Scottish or Asian British: Chinese - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                              asian: chinese - scotland ethnic category 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50949. |                                                                                                                                      term |
        |                                    Asian or Asian Scottish or Asian British: any other Asian group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                         asian: other asian group - scotland ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50950. |                                                                                                                                      term |
        |                                              African: African, African Scottish or African British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                         african: african/african scot/african brit - scotland 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50951. |                                                                                                                                      term |
        |                                                                         African: any other African - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       african: any other african - scotland ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50952. |                                                                                                                                      term |
        |                             Caribbean or Black: Caribbean, Caribbean Scottish or Caribbean British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                        carib/black: caribbean/carib scot/carib brit- scotland 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50954. |                                                                                                                                      term |
        |                                             Caribbean or Black: any other Black or Caribbean group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                         carib/black: any other black/caribbean grp - scotland 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50956. |                                                                                                                                      term |
        |                                            Other ethnic group: Arab, Arab Scottish or Arab British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       other ethnic grp: arab/arab scot/arab british- scotland 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50957. |                                                                                                                                      term |
        |                                                         Other ethnic group: any other ethnic group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       other ethnic grp: any other ethnic grp- scotland 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 85125. |                                                                                                                                      term |
        |                                                                                                                      Asian - ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                                                                        other asian                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
148901. |                                                                                                                                      term |
        |                                                                                                                      White - ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                                                           other white ethnic group                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
148949. |                                                                                                                                      term |
        |                                                                                                                              Ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                                                                 other ethnic group                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
166262. |                                                                                                                                      term |
        |                                                                                                   Black East African Asian/Indo-Caribbean |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                                                     black e afric asia/indo-caribb                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236670. |                                                                                                                                      term |
        |                                                           Baltic States (Estonian or Latvian or Lithuanian) - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                        baltic estonian/latvian/lithuanian - ethn categ 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236671. |                                                                                                                                      term |
        |                                                                Commonwealth of (Russian) Independent States - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       commonwealth (russian) indep states - ethn categ 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236672. |                                                                                                                                      term |
        |                                                         Other republics which made up the former Yugoslavia - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       other republics former yugoslavia - ethnic categ 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236673. |                                                                                                                                      term |
        |                                              Other White European or European unspecified or Mixed European - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                        oth white european/european unsp/mixed european 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236675. |                                                                                                                                      term |
        |                                                                            Other White or White unspecified - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       other white or white unspecified ethnic category 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236676. |                                                                                                                                      term |
        |                                                                            Other Mixed or Mixed unspecified - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       other mixed or mixed unspecified ethnic category 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236677. |                                                                                                                                      term |
        |                                                                          Bangladeshi or British Bangladeshi - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                        bangladeshi or british bangladeshi - ethn categ 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236678. |                                                                                                                                      term |
        |                                                                            Other Asian or Asian unspecified - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       other asian or asian unspecified ethnic category 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236680. |                                                                                                                                      term |
        |                                                                            Other Black or Black unspecified - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       other black or black unspecified ethnic category 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236681. |                                                                                                                                      term |
        |                                                        Middle Eastern (excluding Israeli, Iranian and Arab) - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                        mid east (excl israeli, iranian & arab) - eth cat 2001 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236682. |                                                                                                                                      term |
        |                                    Multi-ethnic islands: Mauritian or Seychellois or Maldivian or St Helena - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2102                                        |
        |                                       mauritian/seychellois/maldivian/st helena eth cat 2001census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

    Result                      Number of obs
    -----------------------------------------
    Not matched                       240,742
        from master                   240,739  (_merge==1)
        from using                          3  (_merge==2)

    Matched                               260
        not updated                       241  (_merge==3)
        missing updated                    19  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------
(3 observations deleted)
Conflicts...
Differences in term from CPRD dictionary...
  63

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50807. |                                                                                                                                      term |
        |                                                                                                                            Afro-Caribbean |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                                                               race: afro-caribbean                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50809. |                                                                                                                                      term |
        |                                                                                                                            Afro-Caucasian |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                                                               race: afro-caucasian                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50821. |                                                                                                                                      term |
        |                                                                                                                            Caucasian race |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                                                                    race: caucasian                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50908. |                                                                                                                                      term |
        |                          White: English or Welsh or Scottish or Northern Irish or British - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       white:eng/welsh/scot/ni/brit - england and wales 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50909. |                                                                                                                                      term |
        |                                                           White: Gypsy or Irish Traveller - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       white: gypsy/irish traveller - eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50910. |                                                                                                                                      term |
        |                                                         White: any other White background - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       white: other white backgrd- eng+wales ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50911. |                                                                                                                                      term |
        |                                   Mixed multiple ethnic groups: White and Black Caribbean - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       mixed: white+black caribbean - eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50912. |                                                                                                                                      term |
        |                                     Mixed multiple ethnic groups: White and Black African - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                         mixed: white+black african - eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50913. |                                                                                                                                      term |
        |                                             Mixed multiple ethnic groups: White and Asian - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                         mixed: white+asian - eng+wales ethnic category 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50915. |                                                                                                                                      term |
        |                                                            Asian or Asian British: Indian - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                        asian/asian brit: indian - eng+wales ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50916. |                                                                                                                                      term |
        |                                                         Asian or Asian British: Pakistani - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       asian/asian british:pakistani- eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50917. |                                                                                                                                      term |
        |                                                       Asian or Asian British: Bangladeshi - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       asian/asian brit: bangladeshi- eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50919. |                                                                                                                                      term |
        |                                                           Asian or Asian British: Chinese - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       asian/asian brit: chinese - eng+wales ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50920. |                                                                                                                                      term |
        |                                        Asian or Asian British: any other Asian background - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       asian/asian brit: other asian- eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50921. |                                                                                                                                      term |
        |                                   Black or African or Caribbean or Black British: African - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       black/african/carib/black brit: african- eng+wales 2011 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50922. |                                                                                                                                      term |
        |                                 Black or African or Caribbean or Black British: Caribbean - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       black/african/caribbn/black brit: caribbean - eng+wales 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50924. |                                                                                                                                      term |
        |                                                                  Other ethnic group: Arab - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                        other ethnic group: arab - eng+wales ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50925. |                                                                                                                                      term |
        |                                                Other ethnic group: any other ethnic group - England and Wales ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                        other ethnic: any other grp - eng+wales eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50926. |                                                                                                                                      term |
        |                                                                            Irish Traveller - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                          irish traveller - northern ireland ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50927. |                                                                                                                                      term |
        |                                    Mixed multiple ethnic groups: White and Black Caribbean - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       mixed: white and black caribbean - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50928. |                                                                                                                                      term |
        |                                      Mixed multiple ethnic groups: White and Black African - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                         mixed: white and black african - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50929. |                                                                                                                                      term |
        |                                              Mixed multiple ethnic groups: White and Asian - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                            mixed: white and asian - ni ethnic category 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50930. |                                                                                                                                      term |
        |                Mixed multiple ethnic groups: any other Mixed or multiple ethnic background - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                        mixed: other mixed/multiple ethnic backgrd - ni 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50931. |                                                                                                                                      term |
        |                                                             Asian or Asian British: Indian - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                         asian or asian british: indian - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50932. |                                                                                                                                      term |
        |                                                          Asian or Asian British: Pakistani - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                         asian/asian british: pakistani - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50933. |                                                                                                                                      term |
        |                                                        Asian or Asian British: Bangladeshi - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       asian/asian british: bangladeshi - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50934. |                                                                                                                                      term |
        |                                                            Asian or Asian British: Chinese - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                           asian/asian british: chinese - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50935. |                                                                                                                                      term |
        |                                         Asian or Asian British: any other Asian background - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       asian/asian british: other asian - ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50936. |                                                                                                                                      term |
        |                                    Black or African or Caribbean or Black British: African - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       black/afri/carib/black brit: african- ni eth cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50937. |                                                                                                                                      term |
        |                                  Black or African or Caribbean or Black British: Caribbean - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       black/afri/carib/black brit: caribbean- ni eth cat 2011 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50939. |                                                                                                                                      term |
        |                                                                   Other ethnic group: Arab - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                          other ethnic group: arab - ni ethnic category 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50940. |                                                                                                                                      term |
        |                                                 Other ethnic group: any other ethnic group - Northern Ireland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       other ethnic group: any other grp- ni ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50942. |                                                                                                                                      term |
        |                                                                    White: Gypsy or Irish Traveller - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       white: gypsy/irish traveller - scotland ethnic cat 2011 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50943. |                                                                                                                                      term |
        |                                                                White: any other White ethnic group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       white: other white ethnic grp- scotland ethnic cat 2011 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50944. |                                                                                                                                      term |
        |                                Mixed or multiple ethnic groups: any Mixed or multiple ethnic group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       mixed/multiple ethnic grps: any- scot ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50945. |                                                                                                                                      term |
        |       Asian or Asian Scottish or Asian British: Pakistani, Pakistani Scottish or Pakistani British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                          asian: pakistani/pakistani scot/pakistani brit- scot 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50946. |                                                                                                                                      term |
        |                Asian or Asian Scottish or Asian British: Indian, Indian Scottish or Indian British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       asian: indian, indian scot/indian brit- scotland 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50947. |                                                                                                                                      term |
        | Asian or Asian Scottish or Asian British: Bangladeshi, Bangladeshi Scottish or Bangladeshi British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       bangladeshi, bangladeshi scot or bangladeshi brit- scot 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50948. |                                                                                                                                      term |
        |                                                  Asian or Asian Scottish or Asian British: Chinese - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                              asian: chinese - scotland ethnic category 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50949. |                                                                                                                                      term |
        |                                    Asian or Asian Scottish or Asian British: any other Asian group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                         asian: other asian group - scotland ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50950. |                                                                                                                                      term |
        |                                              African: African, African Scottish or African British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                         african: african/african scot/african brit - scotland 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50951. |                                                                                                                                      term |
        |                                                                         African: any other African - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       african: any other african - scotland ethnic cat 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50952. |                                                                                                                                      term |
        |                             Caribbean or Black: Caribbean, Caribbean Scottish or Caribbean British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                        carib/black: caribbean/carib scot/carib brit- scotland 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50954. |                                                                                                                                      term |
        |                                             Caribbean or Black: any other Black or Caribbean group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                         carib/black: any other black/caribbean grp - scotland 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50956. |                                                                                                                                      term |
        |                                            Other ethnic group: Arab, Arab Scottish or Arab British - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       other ethnic grp: arab/arab scot/arab british- scotland 2011                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 50957. |                                                                                                                                      term |
        |                                                         Other ethnic group: any other ethnic group - Scotland ethnic category 2011 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       other ethnic grp: any other ethnic grp- scotland 2011 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
 85125. |                                                                                                                                      term |
        |                                                                                                                      Asian - ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                                                                        other asian                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
147505. |                                                                                                                                      term |
        |                                                                              Refusal by patient to provide information about ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                                           ethnic group not given - patient refused                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
148901. |                                                                                                                                      term |
        |                                                                                                                      White - ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                                                           other white ethnic group                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
148949. |                                                                                                                                      term |
        |                                                                                                                              Ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                                                                 other ethnic group                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
166262. |                                                                                                                                      term |
        |                                                                                                   Black East African Asian/Indo-Caribbean |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                                                     black e afric asia/indo-caribb                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
200028. |                                                                                                                                      term |
        |                                                                                                                      Ethnic group finding |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                                                             ethnic groups (census)                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236670. |                                                                                                                                      term |
        |                                                           Baltic States (Estonian or Latvian or Lithuanian) - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                        baltic estonian/latvian/lithuanian - ethn categ 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236671. |                                                                                                                                      term |
        |                                                                Commonwealth of (Russian) Independent States - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       commonwealth (russian) indep states - ethn categ 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236672. |                                                                                                                                      term |
        |                                                         Other republics which made up the former Yugoslavia - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       other republics former yugoslavia - ethnic categ 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236673. |                                                                                                                                      term |
        |                                              Other White European or European unspecified or Mixed European - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                        oth white european/european unsp/mixed european 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236675. |                                                                                                                                      term |
        |                                                                            Other White or White unspecified - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       other white or white unspecified ethnic category 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236676. |                                                                                                                                      term |
        |                                                                            Other Mixed or Mixed unspecified - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       other mixed or mixed unspecified ethnic category 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236677. |                                                                                                                                      term |
        |                                                                          Bangladeshi or British Bangladeshi - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                        bangladeshi or british bangladeshi - ethn categ 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236678. |                                                                                                                                      term |
        |                                                                            Other Asian or Asian unspecified - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       other asian or asian unspecified ethnic category 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236680. |                                                                                                                                      term |
        |                                                                            Other Black or Black unspecified - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       other black or black unspecified ethnic category 2001 census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236681. |                                                                                                                                      term |
        |                                                        Middle Eastern (excluding Israeli, Iranian and Arab) - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                        mid east (excl israeli, iranian & arab) - eth cat 2001 cens                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------+
236682. |                                                                                                                                      term |
        |                                    Multi-ethnic islands: Mauritian or Seychellois or Maldivian or St Helena - ethnic category 2001 census |
        |-------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                                    term_lshtm_2414                                        |
        |                                       mauritian/seychellois/maldivian/st helena eth cat 2001census                                        |
        +-------------------------------------------------------------------------------------------------------------------------------------------+
(label eth5 already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                       240,728
        from master                   240,728  (_merge==1)
        from using                          0  (_merge==2)

    Matched                               271
        not updated                       231  (_merge==3)
        missing updated                    40  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------
(0 observations deleted)
Conflicts...
Differences in term from CPRD dictionary...
  0

. 
. //SNOMED CT lists
. foreach external_sct in oc_opensafely_ethnicity {
  2.         
.         merge m:1 snomedctconceptid using ``external_sct'', update //replace
  3.         drop if _merge == 2
  4.         
.         display "Conflicts..."
  5.         list medcodeid term eth16 eth5 if _merge == 5
  6.         drop _merge
  7.         
.         drop term_`external_sct'
  8. }
(label eth5 already defined)
(label eth16 already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                       241,052
        from master                   240,714  (_merge==1)
        from using                        338  (_merge==2)

    Matched                               285
        not updated                       243  (_merge==3)
        missing updated                    42  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------
(338 observations deleted)
Conflicts...

. 
. order external_codelist, after(term)

. order lshtm_* oc_*, last

. count
  240,999

. 
. //Fill in gaps with OpenSAFELY codelist categories
. replace eth5 = eth5_oc_opensafely_ethnicity if eth5 == .
(43 real changes made)

. replace eth16 = eth16_oc_opensafely_ethnicity if eth16 == .
(65 real changes made)

. 
. //Choose correct value for conflicts
. list medcodeid term eth5 eth5_oc_opensafely_ethnicity ///
>         if eth5 != eth5_oc_opensafely_ethnicity & eth5_oc_opensafely_ethnicity != .

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
 33713. |        medcodeid |                                                                                                                        term |        eth5 |
        |        250243013 |                                                                                                           Race: West indian | South Asian |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                               Black                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
 63211. |        medcodeid |                                                                                                                        term |        eth5 |
        |        285951012 |                                                                                                        Black - other, mixed |       Black |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                               Mixed                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
 63296. |        medcodeid |                                                                                                                        term |        eth5 |
        |        286018012 |                                                                                                            South East Asian |       Other |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                         South Asian                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
170590. |        medcodeid |                                                                                                                        term |        eth5 |
        |  196661000006114 |                                                                                                                    Japanese |       Other |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                         South Asian                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
233039. |        medcodeid |                                                                                                                        term |        eth5 |
        |  141511000000116 |                                                                                   Mixed Asian - ethnic category 2001 census | South Asian |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                               Mixed                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
233175. |        medcodeid |                                                                                                                        term |        eth5 |
        |  158371000000111 |                                                                                   Mixed Black - ethnic category 2001 census |       Black |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                               Mixed                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
233219. |        medcodeid |                                                                                                                        term |        eth5 |
        |  141621000000111 |                                                                                    Vietnamese - ethnic category 2001 census |       Other |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                         South Asian                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
233226. |        medcodeid |                                                                                                                        term |        eth5 |
        |  141631000000113 |                                                                                      Japanese - ethnic category 2001 census |       Other |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                         South Asian                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
233233. |        medcodeid |                                                                                                                        term |        eth5 |
        |  141641000000116 |                                                                                      Filipino - ethnic category 2001 census |       Other |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                         South Asian                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
233243. |        medcodeid |                                                                                                                        term |        eth5 |
        |  141651000000118 |                                                                                     Malaysian - ethnic category 2001 census |       Other |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                         South Asian                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
234354. |        medcodeid |                                                                                                                        term |        eth5 |
        |  142811000000112 |                                                                                 North African - ethnic category 2001 census |       Other |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                               Black                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
239037. |        medcodeid |                                                                                                                        term |        eth5 |
        | 1968121000006114 | Mixed multiple ethnic groups: any other Mixed or multiple ethnic background - England and Wales ethnic category 2011 census |       White |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                                         eth5_oc_o~y                                                                          |
        |                                                                               Mixed                                                                          |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------+

. 
. display "Changing..."
Changing...

. local changes "250243013 141511000000116 158371000000111 1968121000006114 285925010 285930014 285976013 405064011 405067016 411578016 411579012 411580010 453109012 453110019 
> 196601000006113 6846371000006111 196641000006110 141521000000110 141591000000113 141601000000119 285951012 4740361000006111"

. foreach change of local changes {
  2.         
.         list observations term eth5* if medcodeid == "`change'"
  3.         replace eth5 = eth5_oc_opensafely_ethnicity if medcodeid == "`change'"
  4.         
.         list observations term eth16* if medcodeid == "`change'"
  5.         replace eth16 = eth16_oc_opensafely_ethnicity if medcodeid == "`change'"
  6. }

        +-------------------------------------------------------+
        | observ~s                term          eth5   eth5_o~y |
        |-------------------------------------------------------|
 33713. |      500   Race: West indian   South Asian      Black |
        +-------------------------------------------------------+
(1 real change made)

        +--------------------------------------------------------+
        | observ~s                term         eth16   eth16_o~y |
        |--------------------------------------------------------|
 33713. |      500   Race: West indian   Other Asian   Caribbean |
        +--------------------------------------------------------+
(1 real change made)

        +-------------------------------------------------------------------------------+
        | observ~s                                        term          eth5   eth5_o~y |
        |-------------------------------------------------------------------------------|
233039. |    10000   Mixed Asian - ethnic category 2001 census   South Asian      Mixed |
        +-------------------------------------------------------------------------------+
(1 real change made)

        +----------------------------------------------------------------------------------+
        | observ~s                                        term         eth16   eth16_oc_~y |
        |----------------------------------------------------------------------------------|
233039. |    10000   Mixed Asian - ethnic category 2001 census   Other Asian   Other Mixed |
        +----------------------------------------------------------------------------------+
(1 real change made)

        +-------------------------------------------------------------------------+
        | observ~s                                        term    eth5   eth5_o~y |
        |-------------------------------------------------------------------------|
233175. |    10000   Mixed Black - ethnic category 2001 census   Black      Mixed |
        +-------------------------------------------------------------------------+
(1 real change made)

        +----------------------------------------------------------------------------------+
        | observ~s                                        term         eth16   eth16_oc_~y |
        |----------------------------------------------------------------------------------|
233175. |    10000   Mixed Black - ethnic category 2001 census   Other Black   Other Mixed |
        +----------------------------------------------------------------------------------+
(1 real change made)

        +-----------------------------------------------------------------------------------------------------------------------------------------------------------+
        | observ~s                                                                                                                          term    eth5   eth5_o~y |
        |-----------------------------------------------------------------------------------------------------------------------------------------------------------|
239037. |    30000   Mixed multiple ethnic groups: any other Mixed or multiple ethnic background - England and Wales ethnic category 2011 census   White      Mixed |
        +-----------------------------------------------------------------------------------------------------------------------------------------------------------+
(1 real change made)

        +--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | observ~s                                                                                                                          term         eth16   eth16_oc_~y |
        |--------------------------------------------------------------------------------------------------------------------------------------------------------------------|
239037. |    30000   Mixed multiple ethnic groups: any other Mixed or multiple ethnic background - England and Wales ethnic category 2011 census   Other Mixed   Other Mixed |
        +--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
(0 real changes made)

        +-------------------------------------+
        | observ~s    term    eth5   eth5_o~y |
        |-------------------------------------|
 63194. |  2000000   White   White      White |
        +-------------------------------------+
(0 real changes made)

        +------------------------------------------+
        | observ~s    term     eth16   eth16_oc_~y |
        |------------------------------------------|
 63194. |  2000000   White   British   Other White |
        +------------------------------------------+
(1 real change made)

        +-----------------------------------------------+
        | observ~s              term    eth5   eth5_o~y |
        |-----------------------------------------------|
 63195. |     3000   Black Caribbean   Black      Black |
        +-----------------------------------------------+
(0 real changes made)

        +------------------------------------------------------+
        | observ~s              term         eth16   eth16_o~y |
        |------------------------------------------------------|
 63195. |     3000   Black Caribbean   Other Black   Caribbean |
        +------------------------------------------------------+
(1 real change made)

        +-------------------------------------------------------------------+
        | observ~s                         term          eth5   eth5_oc_o~y |
        |-------------------------------------------------------------------|
 63240. |     8000   Indian sub-continent (NMO)   South Asian   South Asian |
        +-------------------------------------------------------------------+
(0 real changes made)

        +----------------------------------------------------------------+
        | observ~s                         term         eth16   eth16_~y |
        |----------------------------------------------------------------|
 63240. |     8000   Indian sub-continent (NMO)   Other Asian     Indian |
        +----------------------------------------------------------------+
(1 real change made)

        +-----------------------------------------------------------+
        | observ~s                          term    eth5   eth5_o~y |
        |-----------------------------------------------------------|
121312. |     3000   Black Caribbean/W.I./Guyana   Black      Black |
        +-----------------------------------------------------------+
(0 real changes made)

        +------------------------------------------------------------------+
        | observ~s                          term         eth16   eth16_o~y |
        |------------------------------------------------------------------|
121312. |     3000   Black Caribbean/W.I./Guyana   Other Black   Caribbean |
        +------------------------------------------------------------------+
(1 real change made)

        +--------------------------------------------------------------+
        | observ~s                             term    eth5   eth5_o~y |
        |--------------------------------------------------------------|
121315. |      900   Caribbean I./W.I./Guyana (NMO)   Black      Black |
        +--------------------------------------------------------------+
(0 real changes made)

        +---------------------------------------------------------------------+
        | observ~s                             term         eth16   eth16_o~y |
        |---------------------------------------------------------------------|
121315. |      900   Caribbean I./W.I./Guyana (NMO)   Other Black   Caribbean |
        +---------------------------------------------------------------------+
(1 real change made)

        +------------------------------------------------------+
        | observ~s                     term    eth5   eth5_o~y |
        |------------------------------------------------------|
125224. |      200   Caribbean Island (NMO)   Black      Black |
        +------------------------------------------------------+
(0 real changes made)

        +-------------------------------------------------------------+
        | observ~s                     term         eth16   eth16_o~y |
        |-------------------------------------------------------------|
125224. |      200   Caribbean Island (NMO)   Other Black   Caribbean |
        +-------------------------------------------------------------+
(1 real change made)

        +-------------------------------------------------+
        | observ~s                term    eth5   eth5_o~y |
        |-------------------------------------------------|
125225. |      100   West Indian (NMO)   Black      Black |
        +-------------------------------------------------+
(0 real changes made)

        +--------------------------------------------------------+
        | observ~s                term         eth16   eth16_o~y |
        |--------------------------------------------------------|
125225. |      100   West Indian (NMO)   Other Black   Caribbean |
        +--------------------------------------------------------+
(1 real change made)

        +--------------------------------------------+
        | observ~s           term    eth5   eth5_o~y |
        |--------------------------------------------|
125226. |       90   Guyana (NMO)   Black      Black |
        +--------------------------------------------+
(0 real changes made)

        +---------------------------------------------------+
        | observ~s           term         eth16   eth16_o~y |
        |---------------------------------------------------|
125226. |       90   Guyana (NMO)   Other Black   Caribbean |
        +---------------------------------------------------+
(1 real change made)

        +-------------------------------------------------+
        | observ~s                term    eth5   eth5_o~y |
        |-------------------------------------------------|
147018. |      600   Black West Indian   Black      Black |
        +-------------------------------------------------+
(0 real changes made)

        +--------------------------------------------------------+
        | observ~s                term         eth16   eth16_o~y |
        |--------------------------------------------------------|
147018. |      600   Black West Indian   Other Black   Caribbean |
        +--------------------------------------------------------+
(1 real change made)

        +--------------------------------------------+
        | observ~s           term    eth5   eth5_o~y |
        |--------------------------------------------|
147019. |      200   Black Guyana   Black      Black |
        +--------------------------------------------+
(0 real changes made)

        +---------------------------------------------------+
        | observ~s           term         eth16   eth16_o~y |
        |---------------------------------------------------|
147019. |      200   Black Guyana   Other Black   Caribbean |
        +---------------------------------------------------+
(1 real change made)

        +----------------------------------------------+
        | observ~s             term    eth5   eth5_o~y |
        |----------------------------------------------|
170092. |     8000   Afro-Caribbean   Black      Black |
        +----------------------------------------------+
(0 real changes made)

        +-----------------------------------------------------+
        | observ~s             term         eth16   eth16_o~y |
        |-----------------------------------------------------|
170092. |     8000   Afro-Caribbean   Other Black   Caribbean |
        +-----------------------------------------------------+
(1 real change made)

        +-----------------------------------------+
        | observ~s        term    eth5   eth5_o~y |
        |-----------------------------------------|
170211. |     1000   Caucasian   White      White |
        +-----------------------------------------+
(0 real changes made)

        +----------------------------------------------+
        | observ~s        term     eth16   eth16_oc_~y |
        |----------------------------------------------|
170211. |     1000   Caucasian   British   Other White |
        +----------------------------------------------+
(1 real change made)

        +----------------------------------------------+
        | observ~s             term    eth5   eth5_o~y |
        |----------------------------------------------|
170209. |    80000   Caucasian race   White      White |
        +----------------------------------------------+
(0 real changes made)

        +---------------------------------------------------+
        | observ~s             term     eth16   eth16_oc_~y |
        |---------------------------------------------------|
170209. |    80000   Caucasian race   British   Other White |
        +---------------------------------------------------+
(1 real change made)

        +------------------------------------------------------------------------------+
        | observ~s                                    term          eth5   eth5_oc_o~y |
        |------------------------------------------------------------------------------|
233062. |     8000   Punjabi - ethnic category 2001 census   South Asian   South Asian |
        +------------------------------------------------------------------------------+
(0 real changes made)

        +---------------------------------------------------------------------------+
        | observ~s                                    term         eth16   eth16_~y |
        |---------------------------------------------------------------------------|
233062. |     8000   Punjabi - ethnic category 2001 census   Other Asian     Indian |
        +---------------------------------------------------------------------------+
(1 real change made)

        +--------------------------------------------------------------------+
        | observ~s                                   term    eth5   eth5_o~y |
        |--------------------------------------------------------------------|
233167. |    90000   Somali - ethnic category 2001 census   Black      Black |
        +--------------------------------------------------------------------+
(0 real changes made)

        +--------------------------------------------------------------------------+
        | observ~s                                   term         eth16   eth16_~y |
        |--------------------------------------------------------------------------|
233167. |    90000   Somali - ethnic category 2001 census   Other Black    African |
        +--------------------------------------------------------------------------+
(1 real change made)

        +----------------------------------------------------------------------+
        | observ~s                                     term    eth5   eth5_o~y |
        |----------------------------------------------------------------------|
233191. |    50000   Nigerian - ethnic category 2001 census   Black      Black |
        +----------------------------------------------------------------------+
(0 real changes made)

        +----------------------------------------------------------------------------+
        | observ~s                                     term         eth16   eth16_~y |
        |----------------------------------------------------------------------------|
233191. |    50000   Nigerian - ethnic category 2001 census   Other Black    African |
        +----------------------------------------------------------------------------+
(1 real change made)

        +----------------------------------------------------+
        | observ~s                   term    eth5   eth5_o~y |
        |----------------------------------------------------|
 63211. |    20000   Black - other, mixed   Black      Mixed |
        +----------------------------------------------------+
(1 real change made)

        +-------------------------------------------------------------+
        | observ~s                   term         eth16   eth16_oc_~y |
        |-------------------------------------------------------------|
 63211. |    20000   Black - other, mixed   Other Black   Other Mixed |
        +-------------------------------------------------------------+
(1 real change made)

        +----------------------------------------------------------------+
        | observ~s                               term    eth5   eth5_o~y |
        |----------------------------------------------------------------|
 63255. |      800   Other ethnic, Asian/White origin   Mixed      Mixed |
        +----------------------------------------------------------------+
(0 real changes made)

        +-----------------------------------------------------------------------------+
        | observ~s                               term         eth16   eth16_oc_open~y |
        |-----------------------------------------------------------------------------|
 63255. |      800   Other ethnic, Asian/White origin   Other Mixed   White and Asian |
        +-----------------------------------------------------------------------------+
(1 real change made)

. 
. display "Leaving as is..."
Leaving as is...

. list term eth5* ///
>         if eth5 != eth5_oc_opensafely_ethnicity & eth5_oc_opensafely_ethnicity != .

        +-------------------------------------------------------------------+
        |                                        term    eth5   eth5_oc_o~y |
        |-------------------------------------------------------------------|
 63296. |                            South East Asian   Other   South Asian |
170590. |                                    Japanese   Other   South Asian |
233219. |    Vietnamese - ethnic category 2001 census   Other   South Asian |
233226. |      Japanese - ethnic category 2001 census   Other   South Asian |
233233. |      Filipino - ethnic category 2001 census   Other   South Asian |
        |-------------------------------------------------------------------|
233243. |     Malaysian - ethnic category 2001 census   Other   South Asian |
234354. | North African - ethnic category 2001 census   Other         Black |
        +-------------------------------------------------------------------+

.         
. list medcodeid term eth16 eth16_oc_opensafely_ethnicity ///
>         if eth16 != eth16_oc_opensafely_ethnicity & eth16_oc_opensafely_ethnicity != .

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
 63252. |        medcodeid |                                                                                                          term |              eth16 |
        |        285990011 |                                                                                Other ethnic, Black/White orig |        Other Mixed |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                               White and Black Caribbean                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
 63253. |        medcodeid |                                                                                                          term |              eth16 |
        | 4740341000006112 |                                                                              Other ethnic, Black/White origin |        Other Mixed |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                               White and Black Caribbean                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
 63296. |        medcodeid |                                                                                                          term |              eth16 |
        |        286018012 |                                                                                              South East Asian | Other ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                             Other Asian                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
125219. |        medcodeid |                                                                                                          term |              eth16 |
        |        411573013 |                                                                                           Black North African |        Other Black |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                                 African                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
233219. |        medcodeid |                                                                                                          term |              eth16 |
        |  141621000000111 |                                                                      Vietnamese - ethnic category 2001 census | Other ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                             Other Asian                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
233226. |        medcodeid |                                                                                                          term |              eth16 |
        |  141631000000113 |                                                                        Japanese - ethnic category 2001 census | Other ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                             Other Asian                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
233233. |        medcodeid |                                                                                                          term |              eth16 |
        |  141641000000116 |                                                                        Filipino - ethnic category 2001 census | Other ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                             Other Asian                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
233243. |        medcodeid |                                                                                                          term |              eth16 |
        |  141651000000118 |                                                                       Malaysian - ethnic category 2001 census | Other ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                             Other Asian                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
234084. |        medcodeid |                                                                                                          term |              eth16 |
        |  142691000000116 |                                                                    Ulster Scots - ethnic category 2001 census |            British |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                             Other White                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
234354. |        medcodeid |                                                                                                          term |              eth16 |
        |  142811000000112 |                                                                   North African - ethnic category 2001 census | Other ethnic group |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                                 African                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
239060. |        medcodeid |                                                                                                          term |              eth16 |
        | 2486161000000112 |                                                          White - Northern Ireland ethnic category 2011 census |            British |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                             Other White                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

        +-------------------------------------------------------------------------------------------------------------------------------------------------------+
239111. |        medcodeid |                                                                                                          term |              eth16 |
        | 1968551000006110 | Caribbean or Black: Caribbean, Caribbean Scottish or Caribbean British - Scotland ethnic category 2011 census |          Caribbean |
        |-------------------------------------------------------------------------------------------------------------------------------------------------------|
        |                                                               eth16_oc_opensafely_eth~y                                                               |
        |                                                                             Other Black                                                               |
        +-------------------------------------------------------------------------------------------------------------------------------------------------------+

.         
. drop eth5_oc_opensafely_ethnicity eth16_oc_opensafely_ethnicity

. 
. 
. //Making some (what I think are) corrections
. local asianother "157351000000115 250268010 1745831000006112 490271012 2694381019 2692541014 2692313014 3493721000006113 3605071000006112 142891000000115"

. foreach code of local asianother {
  2.         
.         replace eth5 = 2 if medcodeid == "`code'"
  3.         replace eth16 = 11 if medcodeid == "`code'"
  4.         list term eth5 eth16 if medcodeid == "`code'"
  5. }
(1 real change made)
(1 real change made)

        +-----------------------------------------------------------------+
        |                                term          eth5         eth16 |
        |-----------------------------------------------------------------|
 16005. | Hindu - ethnic category 2001 census   South Asian   Other Asian |
        +-----------------------------------------------------------------+
(1 real change made)
(1 real change made)

        +-----------------------------------+
        |  term          eth5         eth16 |
        |-----------------------------------|
 33729. | Hindu   South Asian   Other Asian |
        +-----------------------------------+
(1 real change made)
(1 real change made)

        +--------------------------------------+
        |     term          eth5         eth16 |
        |--------------------------------------|
 49436. | Nepalese   South Asian   Other Asian |
        +--------------------------------------+
(1 real change made)
(1 real change made)

        +----------------------------------+
        | term          eth5         eth16 |
        |----------------------------------|
156898. | Sikh   South Asian   Other Asian |
        +----------------------------------+
(1 real change made)
(1 real change made)

        +--------------------------------------------+
        |           term          eth5         eth16 |
        |--------------------------------------------|
176230. | Advaitin Hindu   South Asian   Other Asian |
        +--------------------------------------------+
(1 real change made)
(1 real change made)

        +----------------------------------------------+
        |             term          eth5         eth16 |
        |----------------------------------------------|
176477. | Arya Samaj Hindu   South Asian   Other Asian |
        +----------------------------------------------+
(1 real change made)
(1 real change made)

        +---------------------------------------------+
        |            term          eth5         eth16 |
        |---------------------------------------------|
177189. | Vaishnava Hindu   South Asian   Other Asian |
        +---------------------------------------------+
(1 real change made)
(1 real change made)

        +--------------------------------------+
        |     term          eth5         eth16 |
        |--------------------------------------|
196303. | Hinduism   South Asian   Other Asian |
        +--------------------------------------+
(1 real change made)
(1 real change made)

        +-------------------------------------+
        |    term          eth5         eth16 |
        |-------------------------------------|
201131. | Sikhism   South Asian   Other Asian |
        +-------------------------------------+
(1 real change made)
(1 real change made)

        +----------------------------------------------------------------+
        |                               term          eth5         eth16 |
        |----------------------------------------------------------------|
234482. | Sikh - ethnic category 2001 census   South Asian   Other Asian |
        +----------------------------------------------------------------+

. 
. local whiteother "250227018 286008019 713761000000111 714141000000111 2691976017"

. foreach code of local whiteother {
  2.         
.         replace eth5 = 1 if medcodeid == "`code'"
  3.         replace eth16 = 3 if medcodeid == "`code'"
  4.         list term eth5 eth16 if medcodeid == "`code'"
  5. }
(0 real changes made)
(1 real change made)

        +-----------------------------------------+
        |              term    eth5         eth16 |
        |-----------------------------------------|
 33696. | Australian origin   White   Other White |
        +-----------------------------------------+
(0 real changes made)
(0 real changes made)

        +------------------------------+
        |   term    eth5         eth16 |
        |------------------------------|
 63278. | Pakeha   White   Other White |
        +------------------------------+
(0 real changes made)
(1 real change made)

        +--------------------------------------+
        |           term    eth5         eth16 |
        |--------------------------------------|
157242. | Greek Catholic   White   Other White |
        +--------------------------------------+
(0 real changes made)
(1 real change made)

        +------------------------------------------+
        |               term    eth5         eth16 |
        |------------------------------------------|
157272. | Ukrainian Catholic   White   Other White |
        +------------------------------------------+
(1 real change made)
(1 real change made)

        +-----------------------------------------+
        |              term    eth5         eth16 |
        |-----------------------------------------|
176768. | Armenian Catholic   White   Other White |
        +-----------------------------------------+

. 
. local blackcarribean "250231012"

. foreach code of local blackcarribean {
  2.         
.         replace eth5 = 3 if medcodeid == "`code'"
  3.         replace eth16 = 12 if medcodeid == "`code'"
  4.         list term eth5 eth16 if medcodeid == "`code'"
  5. }
(1 real change made)
(1 real change made)

        +----------------------------------------+
        |               term    eth5       eth16 |
        |----------------------------------------|
 33702. | West Indian origin   Black   Caribbean |
        +----------------------------------------+

. 
. local otherchinese "713491000000110"

. foreach code of local otherchinese {
  2.         
.         replace eth5 = 4 if medcodeid == "`code'"
  3.         replace eth16 = 15 if medcodeid == "`code'"
  4.         list term eth5 eth16 if medcodeid == "`code'"
  5. }
(0 real changes made)
(1 real change made)

        +-------------------------------------------------+
        |                          term    eth5     eth16 |
        |-------------------------------------------------|
157209. | Chinese Evangelical Christian   Other   Chinese |
        +-------------------------------------------------+

. 
. local otherother "1573191000006117 250225014 250226010 2849971000006118 196661000006114 196701000006118 3748491000006113"

. foreach code of local otherother {
  2.         
.         replace eth5 = 4 if medcodeid == "`code'"
  3.         replace eth16 = 16 if medcodeid == "`code'"
  4.         list term eth5 eth16 if medcodeid == "`code'"
  5. }
(0 real changes made)
(1 real change made)

        +----------------------------------------+
        |      term    eth5                eth16 |
        |----------------------------------------|
 30268. | Brazilian   Other   Other ethnic group |
        +----------------------------------------+
(0 real changes made)
(1 real change made)

        +----------------------------------------------------+
        |                  term    eth5                eth16 |
        |----------------------------------------------------|
 33694. | North American origin   Other   Other ethnic group |
        +----------------------------------------------------+
(0 real changes made)
(1 real change made)

        +----------------------------------------------------+
        |                  term    eth5                eth16 |
        |----------------------------------------------------|
 33695. | South American origin   Other   Other ethnic group |
        +----------------------------------------------------+
(1 real change made)
(1 real change made)

        +------------------------------------------+
        |        term    eth5                eth16 |
        |------------------------------------------|
 89920. | Indonesians   Other   Other ethnic group |
        +------------------------------------------+
(0 real changes made)
(1 real change made)

        +---------------------------------------+
        |     term    eth5                eth16 |
        |---------------------------------------|
170590. | Japanese   Other   Other ethnic group |
        +---------------------------------------+
(1 real change made)
(1 real change made)

        +---------------------------------------+
        |     term    eth5                eth16 |
        |---------------------------------------|
170786. | Oriental   Other   Other ethnic group |
        +---------------------------------------+
(1 real change made)
(1 real change made)

        +----------------------------------------+
        |      term    eth5                eth16 |
        |----------------------------------------|
215423. | Filipinos   Other   Other ethnic group |
        +----------------------------------------+

. 
. local remove "6260901000006118 459785017"

. foreach code of local remove {
  2.         
.         list term eth5 eth16 if medcodeid == "`code'"
  3.         drop if medcodeid == "`code'"
  4. }

        +------------------------------+
        |         term    eth5   eth16 |
        |------------------------------|
156399. | Ethnic group   Other       . |
        +------------------------------+
(1 observation deleted)

        +-------------------------------------------+
        |         term    eth5                eth16 |
        |-------------------------------------------|
158424. | Ethnic group   Other   Other ethnic group |
        +-------------------------------------------+
(1 observation deleted)

. 
. 
. // STEP 1. IDENTIFY SEARCH TERMS
. //===============================
. 
. // JUST AMALGAMATING/MODIFIYING EXISTING LISTS; NO SEARCH REQUIRED
. keep if external_codelist == 1
(240,657 observations deleted)

. drop if eth5 == .
(19 observations deleted)

. compress
  variable medcodeid was str18 now str17
  variable originalreadcode was str19 now str13
  variable snomedctconceptid was str18 now str16
  variable snomedctdescriptionid was str18 now str16
  variable term was str233 now str142
  (32,742 bytes saved)

. 
. // **Define search terms below. Use multiple local macros if categorising desired codes in to multiple categories make more sense**
. /*
> local ethnicity " "*ethnicity*" "
> 
> 
> // STEP 2. SEARCH THE MEDICAL TERMINOLOGY DICTIONARY USING THE SEARCH TERMS
> //==========================================================================
> 
> // **Add any additional local macros if you have used more than 1**
> //For each specified local macro...
> foreach termgroup in /**/ethnicity/**/ {
>         
>         //Generate an empty binary indicator variable taking the name of the local macro
>         gen byte `termgroup' = .
>         
>         //For each SNOMED CT term description (converted to lower case)...
>         foreach codeterm in lower(term) {
>                 
>                 //For each individual search term in the local macro
>                 foreach searchterm in ``termgroup'' {
>                         
>                         //Set the indicator variable to 1 if the SNOMED CT term description matches the search term from the local macro
>                         replace `termgroup' = 1 if strmatch(`codeterm', "`searchterm'")
>                 }
>         }
> }
> 
> keep if /**/ethnicity == 1/**/ | external_codelist == 1
> compress
> 
> order /**/ethnicity/**/, after(term)
> gsort /**/ethnicity/**/ -observations snomedctconceptid snomedctdescriptionid originalreadcode
> 
> tab1 /**/ethnicity/**/
> 
> 
> // (OPTIONAL) STEP 3. PERFORM A SECONDARY SEARCH TO EXCLUDE BROAD UNDESIRED TERMS
> //================================================================================
> 
> //Comment out this section if not required.
> 
> // **Exclusion terms**
> 
> local exclude " "*excludeme*" "
> 
> //Search for codes to exclude
> foreach excludeterm in exclude /**/ /*ANY OTHER EXCLUSION CATEGORIES*/ /**/ {
> 
>         gen byte `excludeterm' = .
> 
>         foreach codeterm in lower(term) {
>                 
>                 foreach searchterm in ``excludeterm'' {         
>                         
>                         replace `excludeterm' = 1 if strmatch(`codeterm', "`searchterm'")
>                 }
>         }
> }
> 
> //Check that nothing important is highlighted for exclusion before dropping
> list medcodeid term if exclude == 1
> /**/ /*ANY OTHER EXCLUSION CATEGORIES*/ /**/
> 
> //Make any corrections
> local corrections "123"
> 
> foreach correction of local corrections {
>         
>         list medcodeid term if medcodeid == "`correction'"
>         
>         foreach var of varlist exclude /**/ /*ANY OTHER EXCLUSION CATEGORIES*/ /**/ {
>         
>                 replace `var' = . if medcodeid == "`correction'"
>         }
> }
> 
> replace exclude = 1 if /**/ /*ANY OTHER EXCLUSION CATEGORIES*/ /**/
> drop if exclude == 1 & external_codelist != 1
> //drop exclude /**/ /*ANY OTHER EXCLUSION CATEGORIES*/ /**/
> count
> compress
> 
> 
> // STEP 4. MANUAL SCREEN OF CODELIST TO REMOVE UNDESIRED TERMS
> //=============================================================
> 
> // **medcodeids to remove**
> local initial_remove "123"
> 
> gen byte remove = 0
> 
> foreach medcode of local initial_remove {
>         
>         replace remove = 1 if medcodeid == "`medcode'"
> }
> 
> list medcodeid snomedctdescriptionid snomedctconceptid originalreadcode term  ///
>         observations external_codelist if remove == 1
> drop if remove == 1 & external_codelist != 1
> 
> //List disagreements between my list and external lists
> replace exclude = 1 if remove == 1
> list term lshtm_* oc_* if exclude == 1 & external_codelist == 1
> 
> // COMMENT HERE
> 
> drop if exclude == 1
> drop exclude /**/ /*ANY OTHER EXCLUSION CATEGORIES*/ /**/ remove
> 
> //External codes that I didn't find
> list medcodeid term *_ext lshtm_* oc_* ///
>         if bmi != 1 & height != 1 & weight != 1 & external_codelist == 1
> 
> // COMMENT HERE
> 
> compress
> tab1 /**/ethnicity/**/
> 
> 
> // (OPTIONAL) STEP 5. USE ANOTHER SEARCH TO AUTOMATE THE CATEGORISATION OF CODES
> //===============================================================================
> 
> //Comment out this section if not required.
> 
> // **Search terms for each categorisation desired**
> local cat1 " "*cat1*" "
> local cat2 " "*cat2*" "
> 
> //Search for codes
> foreach categoryterm in /**/cat1 cat2/**/ {
>         
>         gen byte `categoryterm' = .
>         
>         foreach codeterm in lower(term) {
>                 
>                 foreach searchterm in ``categoryterm'' {                
>                         
>                         replace `categoryterm' = 1 if strmatch(`codeterm', "`searchterm'")
>                 }
>         }
> }
> 
> tab1 cat1 cat2
> gsort cat1 cat2
> 
> //Already categorised, but requires fixing
> replace weight = . if bmi == 1
> */
. 
. // STEP 6. USE THE SNOMED CT CONCEPT ID TO FIND ADDITIONAL SYNONYMOUS TERMS
. //==========================================================================
. 
. //Check for missing SNOMED CT Concepts
. codebook snomedctconceptid

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
snomedctconceptid                                                                                                                                              SnomedCTConceptId
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  Type: String (str16)

         Unique values: 297                       Missing "": 0/321

              Examples: "186022004"
                        "315635008"
                        "88911000000101"
                        "94031000000102"

. assert !missing(snomedctconceptid)

. 
. count
  321

. 
. //Make a note of current list
. preserve

.         keep medcodeid /**/eth5 eth16 lshtm_* oc_* /**/

.         gen byte original = 1

.         tempfile original

.         save `original'
file C:\Users\rmjlton\AppData\Local\Temp\ST_6a40_000009.tmp saved as .dta format

. restore

. 
. //Merge SNOMED CT Concepts with medical dictionary
. keep snomedctconceptid /**/eth5 eth16/**/

. bysort snomedctconceptid: keep if _n == 1
(24 observations deleted)

. 
. //Merge with original search results
. merge 1:m snomedctconceptid using `medical', nogenerate keep(match)
(variable snomedctconceptid was str16, now str18 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                               333  
    -----------------------------------------

. compress
  variable snomedctconceptid was str18 now str16
  variable medcodeid was str18 now str17
  variable originalreadcode was str19 now str13
  variable snomedctdescriptionid was str18 now str16
  variable term was str233 now str142
  (33,966 bytes saved)

. merge 1:1 medcodeid using `original', nogenerate
(label eth16 already defined)
(label eth5 already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            12
        from master                        12  
        from using                          0  

    Matched                               321  
    -----------------------------------------

. order medcodeid observations originalreadcode cleansedreadcode ///
>         snomedctconceptid snomedctdescriptionid term

. gsort /**/eth5 eth16/**/ originalreadcode

. 
. //Label new codes
. gen new_snomedct_synonym = (original != 1)

. drop original

. 
. //Show new codes
. foreach category of varlist /**/eth5 eth16/**/ {
  2.         
.         display "New terms found for: `category'"
  3.         list snomedctconceptid originalreadcode term if new_snomedct_synonym == 1 & `category' != .
  4. }
New terms found for: eth5

     +---------------------------------------------------------------------------------------+
     | snomedctconce~d   originalrea~e                                                  term |
     |---------------------------------------------------------------------------------------|
 87. |       428816005   ^ESCTAR709412               Armenian Catholic, follower of religion |
 89. | 368051000000100   ^ESCTBR811943               British Israelite, follower of religion |
 96. | 368191000000107   ^ESCTGR811974                  Greek Catholic, follower of religion |
104. | 368311000000101   ^ESCTUK811999              Ukrainian Catholic, follower of religion |
159. |       427963008   ^ESCTAD708142                  Advaitin Hindu, follower of religion |
     |---------------------------------------------------------------------------------------|
160. |       428347009   ^ESCTAR708714                Arya Samaj Hindu, follower of religion |
162. |       160545000   ^ESCTHI453278                           Hindu, follower of religion |
165. |        67929006   ^ESCTSI360508                                         Sikh religion |
166. |       366740002   ^ESCTSI629668                            Sikh, follower of religion |
167. |       429511004   ^ESCTVA710449                 Vaishnava Hindu, follower of religion |
     |---------------------------------------------------------------------------------------|
230. | 368101000000100   ^ESCTCH811955   Chinese Evangelical Christian, follower of religion |
245. |       372148003             9SJ                                          Ethnic group |
     +---------------------------------------------------------------------------------------+
New terms found for: eth16

     +---------------------------------------------------------------------------------------+
     | snomedctconce~d   originalrea~e                                                  term |
     |---------------------------------------------------------------------------------------|
 87. |       428816005   ^ESCTAR709412               Armenian Catholic, follower of religion |
 89. | 368051000000100   ^ESCTBR811943               British Israelite, follower of religion |
 96. | 368191000000107   ^ESCTGR811974                  Greek Catholic, follower of religion |
104. | 368311000000101   ^ESCTUK811999              Ukrainian Catholic, follower of religion |
159. |       427963008   ^ESCTAD708142                  Advaitin Hindu, follower of religion |
     |---------------------------------------------------------------------------------------|
160. |       428347009   ^ESCTAR708714                Arya Samaj Hindu, follower of religion |
162. |       160545000   ^ESCTHI453278                           Hindu, follower of religion |
165. |        67929006   ^ESCTSI360508                                         Sikh religion |
166. |       366740002   ^ESCTSI629668                            Sikh, follower of religion |
167. |       429511004   ^ESCTVA710449                 Vaishnava Hindu, follower of religion |
     |---------------------------------------------------------------------------------------|
230. | 368101000000100   ^ESCTCH811955   Chinese Evangelical Christian, follower of religion |
245. |       372148003             9SJ                                          Ethnic group |
     +---------------------------------------------------------------------------------------+

. 
. //Check new codes in the context of originally included SNOMED CT Concept ID codes
. preserve

.         keep if new_snomedct_synonym == 1
(321 observations deleted)

.         keep snomedctconceptid

.         bysort snomedctconceptid: keep if _n == 1
(0 observations deleted)

. 
.         count
  12

.         local obs = r(N)

. 
.         forvalues i = 1/`obs' {
  2.                 
.                 if `i' == 1 {
  3.                         
.                         local expanded_ids = snomedctconceptid in `i'
  4.                 }
  5.                 else {
  6.                         
.                         local expanded_ids = "`expanded_ids' " + snomedctconceptid in `i'
  7.                 }
  8.         }

. restore

. 
. foreach expanded_id of local expanded_ids {
  2.         
.         display "SNOMED CT Concept ID for which additional terms where found: `expanded_id'"
  3.         
.         list medcodeid originalreadcode term new_snomedct_synonym eth5 eth16 ///
>                 if snomedctconceptid == "`expanded_id'"
  4. }
SNOMED CT Concept ID for which additional terms where found: 160545000

     +-------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                          term   new_sn~m          eth5         eth16 |
     |-------------------------------------------------------------------------------------------------------|
131. |        250268010            1358                         Hindu          0   South Asian   Other Asian |
162. | 4532781000006115   ^ESCTHI453278   Hindu, follower of religion          1   South Asian   Other Asian |
     +-------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 366740002

     +------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                         term   new_sn~m          eth5         eth16 |
     |------------------------------------------------------------------------------------------------------|
132. |        490271012            135B                         Sikh          0   South Asian   Other Asian |
166. | 6296681000006115   ^ESCTSI629668   Sikh, follower of religion          1   South Asian   Other Asian |
     +------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 368051000000100

     +-------------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                                      term   new_sn~m    eth5         eth16 |
     |-------------------------------------------------------------------------------------------------------------|
 29. |  713341000000111            13y6                         British Israelite          0   White   Other White |
 89. | 8119431000006119   ^ESCTBR811943   British Israelite, follower of religion          1   White   Other White |
     +-------------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 368101000000100

     +---------------------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                                                  term   new_sn~m    eth5     eth16 |
     |---------------------------------------------------------------------------------------------------------------------|
223. |  713491000000110            13yp                         Chinese Evangelical Christian          0   Other   Chinese |
230. | 8119551000006110   ^ESCTCH811955   Chinese Evangelical Christian, follower of religion          1   Other   Chinese |
     +---------------------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 368191000000107

     +----------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                                   term   new_sn~m    eth5         eth16 |
     |----------------------------------------------------------------------------------------------------------|
 30. |  713761000000111            13yY                         Greek Catholic          0   White   Other White |
 96. | 8119741000006115   ^ESCTGR811974   Greek Catholic, follower of religion          1   White   Other White |
     +----------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 368311000000101

     +--------------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                                       term   new_sn~m    eth5         eth16 |
     |--------------------------------------------------------------------------------------------------------------|
 32. |  714141000000111            13z5                         Ukrainian Catholic          0   White   Other White |
104. | 8119991000006114   ^ESCTUK811999   Ukrainian Catholic, follower of religion          1   White   Other White |
     +--------------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 372148003

     +-------------------------------------------------------------------------------------------+
     | medcodeid   origin~e                         term   new_sn~m    eth5                eth16 |
     |-------------------------------------------------------------------------------------------|
245. | 459785017        9SJ                 Ethnic group          1   Other   Other ethnic group |
255. | 286017019       9T1A   Other Pacific ethnic group          0   Other   Other ethnic group |
     +-------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 427963008

     +----------------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                                   term   new_sn~m          eth5         eth16 |
     |----------------------------------------------------------------------------------------------------------------|
134. |       2694381019            13zf                         Advaitin Hindu          0   South Asian   Other Asian |
159. | 7081421000006118   ^ESCTAD708142   Advaitin Hindu, follower of religion          1   South Asian   Other Asian |
     +----------------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 428347009

     +------------------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                                     term   new_sn~m          eth5         eth16 |
     |------------------------------------------------------------------------------------------------------------------|
135. |       2692541014            13zg                         Arya Samaj Hindu          0   South Asian   Other Asian |
160. | 7087141000006111   ^ESCTAR708714   Arya Samaj Hindu, follower of religion          1   South Asian   Other Asian |
     +------------------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 428816005

     +-------------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                                      term   new_sn~m    eth5         eth16 |
     |-------------------------------------------------------------------------------------------------------------|
 31. |       2691976017            13z4                         Armenian Catholic          0   White   Other White |
 87. | 7094121000006112   ^ESCTAR709412   Armenian Catholic, follower of religion          1   White   Other White |
     +-------------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 429511004

     +-----------------------------------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e                                    term   new_sn~m          eth5         eth16 |
     |-----------------------------------------------------------------------------------------------------------------|
133. |       2692313014            13zb                         Vaishnava Hindu          0   South Asian   Other Asian |
167. | 7104491000006111   ^ESCTVA710449   Vaishnava Hindu, follower of religion          1   South Asian   Other Asian |
     +-----------------------------------------------------------------------------------------------------------------+
SNOMED CT Concept ID for which additional terms where found: 67929006

     +-----------------------------------------------------------------------------------------+
     |        medcodeid   originalrea~e            term   new_sn~m          eth5         eth16 |
     |-----------------------------------------------------------------------------------------|
164. | 3605071000006112   ^ESCTSI360507         Sikhism          0   South Asian   Other Asian |
165. | 3605081000006110   ^ESCTSI360508   Sikh religion          1   South Asian   Other Asian |
     +-----------------------------------------------------------------------------------------+

. 
. //Any corrections
. list if medcodeid == "459785017"

     +------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
     | medcodeid   observ~s   origin~e   cleans~e   snome~tid   snomed~nid           term                eth16    eth5   lsh~2102   lsh~2414   lsh~4214   oc_ope~y   new_sn~m |
     |------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
245. | 459785017     100000        9SJ    9SJ..00   372148003   1210724015   Ethnic group   Other ethnic group   Other          .          .          .          .          1 |
     +------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

. drop if medcodeid == "459785017"
(1 observation deleted)

. 
. 
. // STEP 7. COMPARE LIST WITH PREVIOUS CODELIST
. //=============================================
. 
. //None - this is the first version of the codelist
. 
. 
. // STEP 8. EXPORT CODELIST FOR REVIEW BY A PRIMARY CARE CLINICIAN
. //================================================================
. /* NOT BEING REVIEWED
> gsort /**/ethnicity/**/ -observations snomedctconceptid snomedctdescriptionid
> compress
> save `filename', replace
> export excel `filename'_raw.xlsx, firstrow(variables) replace
> 
> //Format Excel file using Python
> python:
> from openpyxl import load_workbook, Workbook
> 
> excel_file = "`filename'_raw.xlsx"
> 
> wb = load_workbook(excel_file)
> ws = wb.active
> 
> # Freeze top row
> ws.freeze_panes = 'A2'
> 
> # Auto-size column widths
> for column in ws.columns:
>         max_length = 0
>         column_letter = column[0].column_letter
> 
>         for cell in column:
>                 try:
>                         if len(str(cell.value)) > max_length:
>                                 max_length = len(cell.value)
>                 except:
>                         pass
> 
>         adjusted_width = (max_length + 2) * 0.92   # this is a bit arbitrary
>         ws.column_dimensions[column_letter].width = adjusted_width
> 
> wb.save(excel_file)
> end
> /*
> Make sure that reviewing clinician's initials are appended to the end of the file name after reviewing.
> 
> e.g. codelist_raw_ABC.xlsx
> */
> */
. 
. // STEP 9. RESTRICT YOUR CODELIST TO CODES APPROVED BY A PRIMARY CARE CLINICIAN AND SAVE
. //=======================================================================================
. 
. //Load clinician classifications
. local clinician "ABC"

. /* NOT CLINICALLY REVIEWED
> import excel `filename'_raw_`clinician', firstrow clear sheet("BP (value)")
> 
> //Remerge with original in case of any formatting issues with Excel spreadsheet
> keep medcodeid `clinician'
> 
> tempfile `clinician'_classification
> save ``clinician'_classification'
> 
> use `filename', clear
> 
> merge 1:1 medcodeid using ``clinician'_classification', nogenerate
> recode `clinician' (. = 0)
> 
> //Remove codes marked for exclusion by clinician
> display "Terms excluded by clinician..."
> list medcodeid snomedctconceptid term if `clinician' == 0
> drop if `clinician' == 0
> */
. //Save clinican approved codelist
. gsort /**/eth5 eth16/**/ -observations snomedctconceptid snomedctdescriptionid originalreadcode

. drop new_snomedct_synonym /*codestatus*/ /*`clinician'*/

. compress
  (0 bytes saved)

. save `filename', replace
file ethnicity.dta saved

. export delimited `filename', replace quote
file ethnicity.csv saved

. 
. 
. // STEP 10. GENERATE METADATA FILE
. //=================================
. 
. //=**Update details here, everything else is automated**========================
. local description "Ethnicity"

. local code_type "medcodeid (SNOMED CT)"

. local database "CPRD Aurum"

. local database_version = ym(real(substr("`aurum_build'", 1, 4)), ///
>                                                         real(substr("`aurum_build'", 5, 2)))

. local author "Philip Stone"

. local date = ym(2024, 12)  //year, month

. local clinical_reviewer ""

. local date_approved = . //year, month

. local notes "The ethnicity categories defined in the 2001 Census: https://www.ethnicity-facts-figures.service.gov.uk/style-guide/ethnic-groups/#2001-census. Rationale being t
> hat NHS Data Model and Dictionary still uses 2001 Census categories. See: https://github.com/opensafely/codelist-development/issues/126. An amalgamation of codelists created 
> by Rohini Mathur and colleagues with some corrections I felt were necessary. 'Not Stated' codes were removed. Created for PRIORITY study."

. local keywords ""

. //==============================================================================
. 
. clear

. gen v1 = ""

. gen v2 = .

. format %tmMon_CCYY v2

. set obs 10
Number of observations (_N) was 0, now 10.

. 
. replace v1 = "`description'" in 1
variable v1 was str1 now str9
(1 real change made)

. replace v1 = "`code_type'" in 2
variable v1 was str9 now str21
(1 real change made)

. replace v1 = "`database'" in 3
(1 real change made)

. replace v2 = `database_version' in 4
(1 real change made)

. replace v1 = "`author'" in 5
(1 real change made)

. replace v2 = `date' in 6
(1 real change made)

. replace v1 = "`clinical_reviewer'" in 7
(0 real changes made)

. replace v2 = `date_approved' in 8
(0 real changes made)

. replace v1 = "`notes'" in 9
variable v1 was str21 now str472
(1 real change made)

. replace v1 = "`keywords'" in 10
(0 real changes made)

. 
. tostring v2, replace usedisplayformat force
v2 was float now str8
v2 was forced to string; some loss of information

. replace v1 = v2 in 4
(1 real change made)

. replace v1 = v2 in 6
(1 real change made)

. replace v1 = v2 in 8
(1 real change made)

. drop v2

. 
. export delimited "`filename'.meta", replace novarnames delimiter(tab)
file ethnicity.meta saved

. 
. 
. use "`filename'", clear  //So that you can see results of search after do file run

. 
. 
. log close
      name:  <unnamed>
       log:  C:\Users\rmjlton\GitHub\priority\codelists\ethnicity.log
  log type:  text
 closed on:  18 Feb 2025, 21:48:24
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
